<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
  <h1>Checkout</h1>
  
  <div class="order-summary">
    <h2>Order Summary</h2>
    <p><strong>Order ID:</strong> <%= order._id %></p>
    <p><strong>Total Amount:</strong> ₹<%= order.totalAmount %></p>
    
    <h3>Items:</h3>
    <ul>
      <% order.items.forEach(item => { %>
        <li><%= item.name %> - Quantity: <%= item.quantity %> - ₹<%= item.price * item.quantity %></li>
      <% }); %>
    </ul>
  </div>

  <button id="pay-button" class="btn">Pay Now</button>

  <script>
    var options = {
      "key": "<%= key_id %>",
      "amount": "<%= razorpayOrder.amount %>",
      "currency": "<%= razorpayOrder.currency %>",
      "name": "E-commerce Store",
      "description": "Order Payment",
      "order_id": "<%= razorpayOrder.id %>",
      "handler": function (response) {
        // Handle successful payment
        var form = document.createElement('form');
        form.method = 'POST';
        form.action = '/payment/success';
        
        var fields = {
          'razorpay_payment_id': response.razorpay_payment_id,
          'razorpay_order_id': response.razorpay_order_id,
          'razorpay_signature': response.razorpay_signature,
          'order_id': '<%= order._id %>'
        };
        
        for (var key in fields) {
          var input = document.createElement('input');
          input.type = 'hidden';
          input.name = key;
          input.value = fields[key];
          form.appendChild(input);
        }
        
        document.body.appendChild(form);
        form.submit();
      },
      "prefill": {
        "name": "<%= typeof session !== 'undefined' && session.username ? session.username : '' %>",
        "email": ""
      },
      "theme": {
        "color": "#3399cc"
      }
    };
    
    var rzp = new Razorpay(options);
    document.getElementById('pay-button').onclick = function(e) {
      rzp.open();
      e.preventDefault();
    }
  </script>

  <p><a href="/cart">Back to Cart</a></p>
</body>
</html> 